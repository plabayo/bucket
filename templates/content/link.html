{% extends "base.html" %}
{% block content %}
{% include "content/shared/link_nav.html" %}
<div class="table rows spacious">
    <div>
        <p>
            Shortlinks are a way to shorten long URLs.
            On this page you can create a shortlink or manage your existing ones.
            Shortlinks can be used by anyone, and require no authentication.
        </p>
    </div>
</div>
<div class="box" style="width: 100%">
    <strong class="block titlebar">🔗 New Shortlink</strong>
    <form action="/link" method="post" style="margin: 10px 0 0 0; padding: 10px;">
        <div class="table rows">
            <p>
                <label for="long">long link:</label>
            </p>
            <input type="hidden" name="action" value="create">
            <p>
                <input id="long" name="long" type="long" placeholder="long"
                    style="width: 100%; margin: auto; vertical-align: middle;" {% match long %} {% when Some with (val)
                    %} value="{{ val }}" {% when None %} {% endmatch %} autofocus>
            </p>
        </div>
        <p>
            <input class="button good big" type="submit" value="🛠️ Create Shortlink" style="float: right;">
        </p>
    </form>
</div>
{% if shortlinks.len() > 0 %}
<div>
    <h3>Previously created shortlinks:</h3>
    <table>
        <thead>
            <tr>
                <th>short</th>
                <th>long</th>
                <th></th>
                <th></th>
            </tr>
        </thead>
        <tbody>
            {% for shortlink in shortlinks %}
            <tr>
                {% let short = shortlink.link_short(scheme, host) %}
                <td>
                    <a href="/{{ shortlink.link_hash() }}" hx-boost="false">{{ short }}</a>
                </td>
                <td>
                    <a href="{{ shortlink.link_long() }}">{{ shortlink.link_long() }}</a>
                </td>
                <td>
                    <button
                        _="on click navigator.clipboard.writeText('{{ short }}')"
                        class="big"
                    >
                        📋&nbsp;Copy
                    </button>
                </td>
                <td>
                    <form action="/link" method="post">
                        <input type="hidden" name="short" value="{{ shortlink.link_hash() }}">
                        <input type="hidden" name="action" value="delete">
                        <input class="button bad big" type="submit" value="🗑️&nbsp;Delete">
                    </form>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endif %}
{% endblock %}